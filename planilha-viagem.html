<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planilha Viagem</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a27; --muted:#8fa3bf; --txt:#e7eefc;
      --line:#22314a; --accent:#4ea1ff; --danger:#ff5d5d; --ok:#2dd4bf;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg, #060912 0%, #0b0f17 100%);
      color:var(--txt);
    }
    .wrap{max-width:980px; margin:0 auto; display:flex; flex-direction:column; gap:12px;}
    header{display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:space-between; gap:10px;}
    h1{margin:0; font-size:20px;}
    .subtitle{color:var(--muted); font-size:12px;}
    .card{
      background:rgba(18,26,39,.95);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    form{display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:end;}
    label{display:flex; flex-direction:column; gap:6px; font-size:12px; color:var(--muted);}
    input{
      background:#0c1320; color:var(--txt);
      border:1px solid var(--line); border-radius:10px;
      padding:12px 12px; font-size:16px; outline:none;
    }
    input:focus{border-color:rgba(78,161,255,.8); box-shadow: 0 0 0 3px rgba(78,161,255,.15);}
    .full{grid-column: 1 / -1;}
    button{
      border:1px solid var(--line);
      background:#0c1320; color:var(--txt);
      padding:12px 12px; border-radius:10px;
      cursor:pointer; font-weight:700; font-size:14px;
      transition:.15s ease;
      width:100%;
    }
    button:hover{transform:translateY(-1px); border-color:rgba(78,161,255,.7);}
    .btn-primary{background:rgba(78,161,255,.15); border-color:rgba(78,161,255,.35);}
    .btn-danger{background:rgba(255,93,93,.12); border-color:rgba(255,93,93,.35);}
    .btn-ok{background:rgba(45,212,191,.12); border-color:rgba(45,212,191,.35);}
    .actions{display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center;}
    .hint{color:var(--muted); font-size:12px;}
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid var(--line);}
    thead th{
      text-align:left; font-size:12px; color:var(--muted);
      background:#0c1320; padding:10px 10px; border-bottom:1px solid var(--line);
    }
    tbody td{padding:10px 10px; border-bottom:1px solid rgba(34,49,74,.6); font-size:14px;}
    tbody tr:last-child td{border-bottom:none;}
    tbody tr:hover td{background:rgba(78,161,255,.06);}
    .row-actions{display:flex; gap:8px; justify-content:flex-end;}
    .small{padding:8px 10px; border-radius:9px; font-size:12px; width:auto;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border:1px dashed rgba(143,163,191,.35);
      border-radius:999px; color:var(--muted); font-size:12px;
    }
    .status{margin-top:8px; font-size:12px; color:var(--muted);}
    .status strong{color:var(--txt);}
    @media (max-width: 420px){
      .actions{grid-template-columns: 1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Planilha Viagem</h1>
        <div class="subtitle">Funciona no celular. Salva os dados neste navegador.</div>
      </div>
      <div class="pill" id="storagePill">üíæ Carregando‚Ä¶</div>
    </header>

    <div class="card">
      <form id="entryForm">
        <label class="full">
          Data
          <input type="date" id="data" required />
        </label>
        <label>
          Entrada
          <input type="time" id="entrada" required />
        </label>
        <label>
          Sa√≠da
          <input type="time" id="saida" required />
        </label>
        <button type="submit" class="btn-primary full">+ Adicionar</button>
      </form>
      <div class="status" id="status"></div>
    </div>

    <div class="card">
      <div class="actions">
        <button class="btn-ok" id="exportCsv" type="button">‚¨áÔ∏è Exportar CSV</button>
        <button class="btn-danger" id="clearAll" type="button">üóëÔ∏è Limpar tudo</button>
      </div>

      <div style="margin-top:12px; overflow:auto;">
        <table aria-label="Planilha">
          <thead>
            <tr>
              <th style="min-width:120px;">Data</th>
              <th style="min-width:90px;">Entrada</th>
              <th style="min-width:90px;">Sa√≠da</th>
              <th style="min-width:110px;">Horas</th>
              <th style="min-width:90px; text-align:right;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="hint" style="margin-top:10px;">
        Dica: no iPhone/Android, abra este arquivo e salve como ‚ÄúAdicionar √† Tela de In√≠cio‚Äù (atalho).
      </div>
    </div>
  </div>

<script>
  const KEY = "planilha_viagem_v1";

  const form = document.getElementById("entryForm");
  const dataEl = document.getElementById("data");
  const entradaEl = document.getElementById("entrada");
  const saidaEl = document.getElementById("saida");

  const tbody = document.getElementById("tbody");
  const statusEl = document.getElementById("status");
  const storagePill = document.getElementById("storagePill");

  const exportBtn = document.getElementById("exportCsv");
  const clearBtn = document.getElementById("clearAll");

  function loadRows(){
    try{
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){
      return [];
    }
  }

  function saveRows(rows){
    localStorage.setItem(KEY, JSON.stringify(rows));
    storagePill.textContent = `üíæ Salvo (${rows.length})`;
  }

  function fmtDate(iso){
    if(!iso) return "";
    const [y,m,d] = iso.split("-");
    return `${d}/${m}/${y}`;
  }

  function diffHours(entrada, saida){
    if(!entrada || !saida) return "";
    const [eh, em] = entrada.split(":").map(Number);
    const [sh, sm] = saida.split(":").map(Number);
    let start = eh*60 + em;
    let end = sh*60 + sm;
    if(end < start) end += 24*60; // virada de dia
    const mins = end - start;
    const h = Math.floor(mins/60);
    const m = mins % 60;
    return `${h}h ${String(m).padStart(2,"0")}m`;
  }

  function render(){
    const rows = loadRows();
    rows.sort((a,b)=> ((a.data||"")+(a.entrada||"")).localeCompare((b.data||"")+(b.entrada||"")));
    tbody.innerHTML = "";

    for(const row of rows){
      const tr = document.createElement("tr");

      const tdData = document.createElement("td"); tdData.textContent = fmtDate(row.data);
      const tdEnt  = document.createElement("td"); tdEnt.textContent  = row.entrada || "";
      const tdSai  = document.createElement("td"); tdSai.textContent  = row.saida || "";
      const tdHor  = document.createElement("td"); tdHor.textContent  = diffHours(row.entrada, row.saida);

      const tdAct = document.createElement("td");
      tdAct.style.textAlign = "right";
      const wrap = document.createElement("div");
      wrap.className = "row-actions";

      const del = document.createElement("button");
      del.className = "small btn-danger";
      del.type = "button";
      del.textContent = "Excluir";
      del.onclick = ()=>{
        const next = loadRows().filter(r=> r.id !== row.id);
        saveRows(next);
        render();
        setStatus("Registro exclu√≠do.");
      };

      wrap.appendChild(del);
      tdAct.appendChild(wrap);

      tr.appendChild(tdData);
      tr.appendChild(tdEnt);
      tr.appendChild(tdSai);
      tr.appendChild(tdHor);
      tr.appendChild(tdAct);

      tbody.appendChild(tr);
    }

    storagePill.textContent = `üíæ Salvo (${rows.length})`;
  }

  function setStatus(msg){
    statusEl.textContent = msg ? `‚úÖ ${msg}` : "";
    if(msg) setTimeout(()=> statusEl.textContent="", 3000);
  }

  function normalizeTime(t){
    if(!t) return "";
    const [h,m] = t.split(":");
    return `${String(h).padStart(2,"0")}:${String(m||"00").padStart(2,"0")}`;
  }

  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    const data = dataEl.value;
    const entrada = normalizeTime(entradaEl.value);
    const saida = normalizeTime(saidaEl.value);

    if(!data || !entrada || !saida){
      setStatus("Preencha Data, Entrada e Sa√≠da.");
      return;
    }

    const rows = loadRows();
    rows.push({
      id: (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
      data, entrada, saida
    });

    saveRows(rows);
    render();
    form.reset();
    setStatus("Adicionado!");
    dataEl.focus();
  });

  exportBtn.addEventListener("click", ()=>{
    const rows = loadRows();
    const header = ["Data","Entrada","Sa√≠da"];
    const lines = [header.join(",")];
    for(const r of rows){
      lines.push([r.data, r.entrada, r.saida].map(v => `"${String(v ?? "").replaceAll('"','""')}"`).join(","));
    }
    const blob = new Blob([lines.join("\\n")], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "planilha-viagem.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    setStatus("CSV exportado.");
  });

  clearBtn.addEventListener("click", ()=>{
    const ok = confirm("Apagar todos os registros desta planilha neste navegador?");
    if(!ok) return;
    localStorage.removeItem(KEY);
    render();
    setStatus("Tudo limpo.");
  });

  (function init(){
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth()+1).padStart(2,"0");
    const dd = String(today.getDate()).padStart(2,"0");
    dataEl.value = `${yyyy}-${mm}-${dd}`;
    render();
  })();
</script>
</body>
</html>
